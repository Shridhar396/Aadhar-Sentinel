<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aadhaar Sentinel | Identity Orchestration</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #0b0e14; color: #e6edf3; display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 380px; background: #161b22; padding: 20px; border-right: 1px solid #30363d; overflow-y: auto; display: flex; flex-direction: column; }
        #map { flex-grow: 1; z-index: 1; }
        .metric-card { background: #0d1117; border: 1px solid #30363d; padding: 15px; border-radius: 6px; margin-bottom: 15px; }
        .critical { color: #f85149; font-weight: bold; font-size: 22px; }
        button { width: 100%; padding: 12px; margin-top: 10px; cursor: pointer; border-radius: 6px; border: none; font-weight: bold; transition: 0.3s; }
        .btn-scan { background: #238636; color: white; }
        .btn-scan:hover { background: #2ea043; }
        .btn-dispatch { background: #da3633; color: white; }
        #log-console { background: #000; color: #39ff14; font-family: 'Courier New', monospace; padding: 10px; font-size: 11px; height: 120px; overflow-y: auto; border-radius: 4px; border: 1px solid #30363d; }
        .chart-container { height: 180px; margin-top: 10px; }
        h3 { font-size: 14px; text-transform: uppercase; color: #8b949e; margin: 15px 0 5px 0; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2 style="margin: 0;">AADHAAR SENTINEL [cite: 1]</h2>
    <p style="font-size: 11px; color: #8b949e; margin-bottom: 20px;">AI-DRIVEN IDENTITY ORCHESTRATION [cite: 2]</p>
    
    <div class="metric-card">
        <div>LIVE BIO-STRESS INDEX [cite: 59]</div>
        <div id="bio-failure-rate" class="critical">1.75 [cite: 103]</div>
        <div style="font-size: 11px; color: #8b949e;">High Failure Loop Detected in Mining Zones [cite: 101]</div>
    </div>

    <div class="metric-card">
        <div id="desert-count" style="font-size: 28px; font-weight: bold;">0</div>
        <div style="font-size: 11px; color: #8b949e;">ACTIVE SERVICE DESERTS [cite: 127]</div>
    </div>

    <h3>Enrollment Lag (0-4 vs 5+) [cite: 87]</h3>
    <div class="chart-container">
        <canvas id="lagChart"></canvas>
    </div>

    <h3>Actions</h3>
    <button class="btn-scan" onclick="runGeospatialScan()">1. RUN GEOSPATIAL SCAN [cite: 129]</button>
    <button class="btn-dispatch" onclick="triggerDispatch()">2. DEPLOY MOBILE UNITS [cite: 162]</button>

    <h3>System Logs</h3>
    <div id="log-console">> System Initialized...<br>> Pulse-Sync Active... [cite: 222]</div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Initialize map on India
    const map = L.map('map').setView([22.5937, 78.9629], 5);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: 'OpenStreetMap CartoDB' // [cite: 149]
    }).addTo(map);

    const consoleLog = document.getElementById('log-console');
    let markers = [];

    function addLog(msg) {
        consoleLog.innerHTML += `<br>> ${msg}`;
        consoleLog.scrollTop = consoleLog.scrollHeight;
    }

    // Initialize the Enrollment Lag Chart [cite: 86, 87]
    const ctx = document.getElementById('lagChart').getContext('2d');
    const lagChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['0-4 Years', '5-17 Years'],
            datasets: [{
                label: 'Avg. Enrollments/Year [cite: 88]',
                data: [85000, 380000], // Based on 400% spike analysis [cite: 86]
                backgroundColor: ['#f85149', '#238636']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, grid: { color: '#30363d' } } }
        }
    });

    async function runGeospatialScan() {
        addLog("Accessing Census & Gazette APIs... [cite: 165]");
        addLog("Calculating Geospatial Score (S)... [cite: 166]");
        
        try {
            const response = await fetch('http://127.0.0.1:5000/api/geospatial');
            const data = await response.json();
            
            // Simulation of high-priority zones identified in analysis 
            const priorityZones = [
                { name: "Barmer", lat: 25.75, lng: 71.38 },
                { name: "West Khasi Hills", lat: 25.51, lng: 91.25 },
                { name: "Dhanbad", lat: 23.79, lng: 86.43 }
            ];

            markers.forEach(m => map.removeLayer(m));
            priorityZones.forEach(zone => {
                const marker = L.circleMarker([zone.lat, zone.lng], {
                    color: '#f85149',
                    fillColor: '#f85149',
                    fillOpacity: 0.6,
                    radius: 12
                }).addTo(map).bindPopup(`<b>${zone.name}</b><br>Status: Critical Service Desert [cite: 66]`);
                markers.push(marker);
            });

            document.getElementById('desert-count').innerText = priorityZones.length;
            addLog("WARNING: 3 High-Stress Zones Detected[cite: 166].");
            addLog(`Priority targets: Barmer, West Khasi Hills.`);
        } catch (e) {
            addLog("Error: Orchestration Engine Unreachable.");
        }
    }

    async function triggerDispatch() {
        addLog("Optimizing Routes via GraphHopper API... [cite: 202]");
        try {
            const response = await fetch('http://127.0.0.1:5000/api/dispatch', { method: 'POST' });
            const data = await response.json();
            addLog("DISPATCH CONFIRMED: 3 Vans en route[cite: 202].");
            addLog("Life-Link Module: Pushing Birth-Enrollment Triggers[cite: 86].");
        } catch (e) {
            addLog("Error confirming dispatch.");
        }
    }
</script>
</body>
</html>